---
import { fetchApi } from "../lib/strapi";
import { Image } from "astro:assets";

interface StudioIntroData {
  title: string;
  description: string;
  rulebookLink: string;
  images: {
    url: string;
    alternativeText: string;
  }[];
}

let data;
try {
  data = await fetchApi<StudioIntroData>({
    endpoint: "studio-intro",
    query: "populate=*",
  });
} catch (e) {
  data = null;
}

if (!data) {
  data = {
    title: "Kameralna i Dopracowana",
    description:
      "Studio to kameralna, starannie dopracowana przestrzeń, w której na wysokiej klasy sprzęcie możesz poznać pilates w jego klasycznej odsłonie. W studio odbywają się treningi indywidualne i w duetach.",
    rulebookLink: "/regulamin",
    images: [
      {
        url: "https://images.unsplash.com/photo-1518611012118-296072bb58c4?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Detail of pilates equipment",
      },
      {
        url: "https://images.unsplash.com/photo-1599447421416-3414500d18a5?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Bright pilates studio interior",
      },
    ],
  };
}

const strapiUrl = import.meta.env.STRAPI_URL || "";
---

<section class="py-20 md:py-32 bg-background-light dark:bg-background-dark">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
      <div class="order-2 md:order-1 space-y-8">
        <h2
          class="text-3xl md:text-4xl font-display text-primary dark:text-white"
        >
          {data.title}
        </h2>
        <div class="w-16 h-0.5 bg-primary dark:bg-white/30"></div>
        <p
          class="text-gray-600 dark:text-gray-300 leading-relaxed font-light text-lg"
        >
          {data.description}
        </p>
        <div class="pt-4">
          <a
            class="inline-flex items-center text-primary dark:text-white border-b border-primary dark:border-white pb-1 hover:opacity-70 transition-opacity"
            href={data.rulebookLink}
          >
            <span class="material-icons-outlined text-sm mr-2">description</span
            >
            <span class="text-sm uppercase tracking-widest"
              >Link do regulaminu</span
            >
          </a>
        </div>
      </div>
      <div class="order-1 md:order-2 grid grid-cols-2 gap-4">
        {
          data.images.map((img, index) => (
            <Image
              src={
                img.url.startsWith("http") ? img.url : `${strapiUrl}${img.url}`
              }
              alt={img.alternativeText}
              width={400}
              height={600}
              class={`w-full h-80 object-cover rounded-sm shadow-sm ${index === 0 ? "transform translate-y-8" : ""}`}
            />
          ))
        }
      </div>
    </div>
  </div>
</section>
