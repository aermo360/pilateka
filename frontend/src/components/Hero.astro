---
import { fetchApi } from "../lib/strapi";
import { Image } from "astro:assets";

interface HeroData {
  title: string;
  subtitle: string;
  description: string;
  backgroundImage: {
    url: string;
    alternativeText: string;
  };
}

let hero;
try {
  hero = await fetchApi<HeroData>({
    endpoint: "hero-section",
    query: "populate=*",
  });
} catch (e) {
  hero = null;
}

if (!hero) {
  // Fallback for development if Strapi is not connected
  hero = {
    title: "PILATEKA",
    subtitle: "STUDIO PILATES",
    description:
      "Pilateka to kameralne studio, w którym na najwyższej jakości sprzęcie, w spokojnej atmosferze poznasz pilates w jego klasycznej odsłonie. Tutaj pilates to nie tylko trening, to powrót do Twojej pełni sił i sprawności.",
    backgroundImage: {
      url: "https://images.unsplash.com/photo-1518611012118-296072bb58c4?auto=format&fit=crop&q=80&w=1920",
      alternativeText: "Abstract gentle pilates movement background",
    },
  };
}

const strapiUrl = import.meta.env.STRAPI_URL || "";
const imageUrl = hero.backgroundImage.url.startsWith("http")
  ? hero.backgroundImage.url
  : `${strapiUrl}${hero.backgroundImage.url}`;
---

<header
  class="relative h-screen flex items-center justify-center overflow-hidden"
>
  <div class="absolute inset-0 bg-primary dark:bg-background-dark z-0">
    <Image
      src={imageUrl}
      alt={hero.backgroundImage.alternativeText}
      width={1920}
      height={1080}
      loading="eager"
      class="w-full h-full object-cover opacity-20 dark:opacity-10 mix-blend-overlay"
    />
  </div>
  <div class="relative z-10 text-center px-4 max-w-7xl mx-auto animate-fade-in">
    <div class="mb-8 select-none">
      <h1
        class="text-5xl md:text-7xl lg:text-8xl text-white font-normal tracking-[0.15em] mb-2 font-accent"
      >
        {hero.title}
      </h1>
      <div class="w-24 md:w-48 h-px bg-white mx-auto my-6"></div>
      <h2
        class="text-lg md:text-xl text-white tracking-[0.3em] font-light uppercase"
      >
        {hero.subtitle}
      </h2>
    </div>
    <p
      class="mt-8 text-lg md:text-xl text-gray-200 font-light max-w-3xl mx-auto leading-relaxed"
    >
      {hero.description}
    </p>
    <div class="mt-12 flex flex-col md:flex-row gap-4 justify-center">
      <a
        class="inline-block px-8 py-3 border border-white text-white uppercase tracking-widest text-sm hover:bg-white hover:text-primary transition-all duration-300"
        href="#studio"
      >
        Więcej
      </a>
    </div>
  </div>
</header>
