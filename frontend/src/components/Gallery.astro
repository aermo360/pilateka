---
import { fetchApi } from "../lib/strapi";
import { Image } from "astro:assets";

interface GalleryItem {
  label: string;
  description: string;
  image: {
    url: string;
    alternativeText: string;
  };
}

let items;
try {
  items = await fetchApi<GalleryItem[]>({
    endpoint: "gallery-items",
    query: "populate=*",
  });
} catch (e) {
  items = null;
}

if (!items || !Array.isArray(items) || items.length === 0) {
  items = [
    {
      label: "SPRZĘT",
      description:
        "Pilateka jest w pełni wyposażona w przygotowywany na zamówienie klasyczny sprzęt marek Legacy Pilates oraz V PILATES APPARATUS.",
      image: {
        url: "https://images.unsplash.com/photo-1599447421416-3414500d18a5?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Close up of pilates equipment details",
      },
    },
    {
      label: "ATMOSFERA",
      description:
        "W studio trenujemy przede wszystkim indywidualnie i w duetach- dzięki temu każdy trening może być dostosowany do Twoich potrzeb i możliwości, bezpieczny i skupiony na Twoich celach.",
      image: {
        url: "https://images.unsplash.com/photo-1522844990219-53587e453eac?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Woman stretching in a bright studio",
      },
    },
    {
      label: "SPOŁECZNOŚĆ",
      description:
        "Oprócz regularnych treningów w studio możemy się spotkać na weekendowych pilatesowych wyjazdach, jednodniowych warsztatach i lekcjach pilatesu na macie w ramach większych eventów.",
      image: {
        url: "https://images.unsplash.com/photo-1552674605-db6ffd4facb5?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Group pilates class session",
      },
    },
  ];
}

const strapiUrl = import.meta.env.STRAPI_URL || "";
---

<section
  class="py-24 bg-background-light dark:bg-background-dark overflow-hidden"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-20 text-center">
    <h3
      class="text-3xl font-accent text-primary dark:text-white uppercase tracking-widest italic"
    >
      Przestrzeń
    </h3>
    <div class="w-16 h-[2px] bg-primary mx-auto mt-6 opacity-30"></div>
  </div>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex space-x-8 overflow-x-auto pb-16 scrollbar-hide snap-x">
      {
        items.map((item) => (
          <div class="flex-shrink-0 snap-center w-80 h-[32rem] md:w-[26rem] md:h-[36rem] relative group cursor-pointer overflow-hidden bg-gray-200 dark:bg-gray-700 shadow-2xl">
            <Image
              src={
                item.image.url.startsWith("http")
                  ? item.image.url
                  : `${strapiUrl}${item.image.url}`
              }
              alt={item.image.alternativeText}
              width={800}
              height={1000}
              class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105 opacity-95 group-hover:opacity-100"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-primary/95 via-primary/40 to-transparent opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-all duration-500 flex flex-col justify-end p-8 md:p-12">
              <p class="text-white text-xs uppercase tracking-[0.3em] mb-4 transform translate-y-0 md:translate-y-4 md:group-hover:translate-y-0 transition-transform duration-500 opacity-80">
                {item.label}
              </p>
              <h4 class="text-2xl md:text-3xl font-accent text-white mb-6 transform translate-y-0 md:translate-y-4 md:group-hover:translate-y-0 transition-transform duration-500 delay-100 italic">
                {item.label}
              </h4>
              <p class="text-blue-50 text-base md:text-lg font-light leading-relaxed transform translate-y-0 md:translate-y-4 md:group-hover:translate-y-0 transition-transform duration-500 delay-200">
                {item.description}
              </p>
            </div>
            <div class="absolute bottom-8 left-8 right-8 flex flex-col opacity-0 md:opacity-100 md:group-hover:opacity-0 transition-opacity duration-300">
              <p class="text-white text-xl font-accent italic tracking-widest uppercase">
                {item.label}
              </p>
              <div class="w-12 h-px bg-white/50 mt-2" />
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>
