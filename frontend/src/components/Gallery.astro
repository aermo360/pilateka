---
import { fetchApi } from "../lib/strapi";
import { Image } from "astro:assets";

interface GalleryItem {
  label: string;
  description: string;
  image: {
    url: string;
    alternativeText: string;
  };
}

let items;
try {
  items = await fetchApi<GalleryItem[]>({
    endpoint: "gallery-items",
    query: "populate=*",
  });
} catch (e) {
  items = null;
}

if (!items || !Array.isArray(items) || items.length === 0) {
  items = [
    {
      label: "SPRZĘT",
      description:
        "Pilateka jest w pełni wyposażona w przygotowywany na zamówienie klasyczny sprzęt marek Legacy Pilates oraz V PILATES APPARATUS.",
      image: {
        url: "https://images.unsplash.com/photo-1599447421416-3414500d18a5?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Close up of pilates equipment details",
      },
    },
    {
      label: "ATMOSFERA",
      description:
        "W studio trenujemy przede wszystkim indywidualnie i w duetach- dzięki temu każdy trening może być dostosowany do Twoich potrzeb i możliwości, bezpieczny i skupiony na Twoich celach.",
      image: {
        url: "https://images.unsplash.com/photo-1522844990219-53587e453eac?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Woman stretching in a bright studio",
      },
    },
    {
      label: "SPOŁECZNOŚĆ",
      description:
        "Oprócz regularnych treningów w studio możemy się spotkać na weekendowych pilatesowych wyjazdach, jednodniowych warsztatach i lekcjach pilatesu na macie w ramach większych eventów.",
      image: {
        url: "https://images.unsplash.com/photo-1552674605-db6ffd4facb5?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Group pilates class session",
      },
    },
  ];
}

const strapiUrl = import.meta.env.STRAPI_URL || "";
---

<section class="py-24 bg-white dark:bg-background-dark overflow-hidden">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-16 text-center">
    <h2 class="text-4xl md:text-5xl font-accent text-primary dark:text-white">
      Przestrzeń
    </h2>
    <div class="w-16 h-[2px] bg-primary mx-auto mt-6 opacity-30"></div>
  </div>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      {
        items.map((item) => (
          <div class="group relative aspect-[3/4] cursor-pointer overflow-hidden bg-gray-100 shadow-sm">
            <Image
              src={
                item.image.url.startsWith("http")
                  ? item.image.url
                  : `${strapiUrl}${item.image.url}`
              }
              alt={item.image.alternativeText}
              width={800}
              height={1000}
              class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105"
            />

            {/* Overlay for labels like in image */}
            <div class="absolute inset-0 bg-gradient-to-t from-primary/80 via-transparent to-transparent opacity-100 transition-opacity duration-300" />

            <div class="absolute bottom-10 left-8 right-8">
              <div class="flex items-center space-x-3 text-white">
                <div class="w-px h-6 bg-white opacity-60" />
                <span class="text-sm tracking-[0.3em] font-light uppercase">
                  {item.label}
                </span>
              </div>
            </div>

            {/* Hover description overlay */}
            <div class="absolute inset-0 bg-primary/90 opacity-0 group-hover:opacity-100 transition-opacity duration-500 flex flex-col justify-center p-8 text-center">
              <h4 class="text-xl md:text-2xl font-accent text-white mb-6 uppercase tracking-widest italic border-b border-white/20 pb-4">
                {item.label}
              </h4>
              <p class="text-blue-50 text-sm md:text-base font-light leading-relaxed">
                {item.description}
              </p>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>
