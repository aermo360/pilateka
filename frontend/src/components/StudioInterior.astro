---
import { fetchApi } from "../lib/strapi";
import { Image } from "astro:assets";

interface StudioGalleryItem {
  image: {
    url: string;
    alternativeText: string;
  };
}

let images;
try {
  images = await fetchApi<StudioGalleryItem[]>({
    endpoint: "studio-gallery-items",
    query: "populate=*",
  });
} catch (e) {
  images = null;
}

if (!images || !Array.isArray(images) || images.length === 0) {
  images = [
    {
      image: {
        url: "https://images.unsplash.com/photo-1518459031867-a89b944bffe4?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Spacious pilates studio",
      },
    },
    {
      image: {
        url: "https://images.unsplash.com/photo-1599447421416-3414500d18a5?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Close up of pilates reformer springs",
      },
    },
    {
      image: {
        url: "https://images.unsplash.com/photo-1522844990219-53587e453eac?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Minimalist corner with plant",
      },
    },
    {
      image: {
        url: "https://images.unsplash.com/photo-1552674605-db6ffd4facb5?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Pilates instructor assisting student",
      },
    },
  ];
}

const strapiUrl = import.meta.env.STRAPI_URL || "";
---

<section
  class="py-20 md:py-32 bg-white dark:bg-background-dark overflow-hidden"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="mb-12 flex flex-col md:flex-row justify-between items-end">
      <div>
        <h2
          class="text-4xl md:text-5xl font-accent text-primary dark:text-white mb-6 uppercase tracking-widest leading-tight"
        >
          Nasza przestrzeń
        </h2>
        <p class="text-gray-400 dark:text-gray-500 font-light max-w-md text-lg">
          Rzut oka na naszą spokojną przestrzeń, wyposażoną w klasyczny sprzęt.
        </p>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 h-auto">
      <div
        class="md:col-span-2 md:row-span-2 relative group overflow-hidden cursor-pointer min-h-[400px] shadow-sm"
      >
        <Image
          src={images[0].image.url.startsWith("http")
            ? images[0].image.url
            : `${strapiUrl}${images[0].image.url}`}
          alt={images[0].image.alternativeText}
          width={800}
          height={800}
          class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105"
        />
        <div
          class="absolute inset-0 bg-primary/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
        >
        </div>
      </div>

      {
        images.slice(1, 4).map((item) => (
          <div class="relative group overflow-hidden cursor-pointer min-h-[250px] shadow-sm">
            <Image
              src={
                item.image.url.startsWith("http")
                  ? item.image.url
                  : `${strapiUrl}${item.image.url}`
              }
              alt={item.image.alternativeText}
              width={400}
              height={400}
              class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105"
            />
            <div class="absolute inset-0 bg-primary/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
          </div>
        ))
      }

      <div
        class="relative group overflow-hidden cursor-pointer min-h-[250px] bg-primary flex items-center justify-center p-8 text-center shadow-sm"
      >
        <div class="space-y-6">
          <span class="material-icons-outlined text-white text-5xl opacity-40"
            >chat_bubble_outline</span
          >
          <h3 class="text-white font-accent text-2xl uppercase tracking-widest">
            Zapraszamy
          </h3>
          <p class="text-blue-50/80 text-sm font-light leading-relaxed">
            Chcesz zobaczyć studio na żywo lub dopytać o szczegóły?
          </p>
          <div class="pt-4">
            <a
              href="/kontakt/"
              class="inline-block bg-white text-primary px-8 py-4 text-[10px] font-bold uppercase tracking-[0.2em] hover:bg-blue-50 transition-colors"
              >Skontaktuj się</a
            >
          </div>
        </div>
      </div>
    </div>

    <div class="md:hidden mt-6 text-center">
      <a
        class="text-primary dark:text-white text-sm uppercase tracking-widest border-b border-primary dark:border-white pb-1"
        href="#">Zobacz wszystkie zdjęcia</a
      >
    </div>
  </div>
</section>
