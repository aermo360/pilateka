---
import { fetchApi } from "../lib/strapi";
import { Image } from "astro:assets";

interface StudioGalleryItem {
  image: {
    url: string;
    alternativeText: string;
  };
}

let images;
try {
  images = await fetchApi<StudioGalleryItem[]>({
    endpoint: "studio-gallery-items",
    query: "populate=*",
  });
} catch (e) {
  images = null;
}

if (!images || !Array.isArray(images) || images.length === 0) {
  images = [
    {
      image: {
        url: "https://images.unsplash.com/photo-1518459031867-a89b944bffe4?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Spacious pilates studio",
      },
    },
    {
      image: {
        url: "https://images.unsplash.com/photo-1599447421416-3414500d18a5?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Close up of pilates reformer springs",
      },
    },
    {
      image: {
        url: "https://images.unsplash.com/photo-1522844990219-53587e453eac?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Minimalist corner with plant",
      },
    },
    {
      image: {
        url: "https://images.unsplash.com/photo-1552674605-db6ffd4facb5?auto=format&fit=crop&q=80&w=800",
        alternativeText: "Pilates instructor assisting student",
      },
    },
  ];
}

const strapiUrl = import.meta.env.STRAPI_URL || "";
---

<section
  class="py-20 md:py-32 bg-white dark:bg-background-dark overflow-hidden"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="mb-12 flex flex-col md:flex-row justify-between items-end">
      <div>
        <h2
          class="text-3xl md:text-4xl font-display text-primary dark:text-white mb-4"
        >
          Nasza przestrzeń
        </h2>
        <p class="text-gray-600 dark:text-gray-400 font-light max-w-md">
          Rzut oka na naszą spokojną przestrzeń, wyposażoną w klasyczny sprzęt.
        </p>
      </div>
      <div class="hidden md:block">
        <a
          class="text-primary dark:text-white text-sm uppercase tracking-widest border-b border-primary dark:border-white pb-1 hover:opacity-70 transition-opacity"
          href="#">Zobacz wszystkie zdjęcia</a
        >
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 h-auto md:h-[600px]">
      <div
        class="md:col-span-2 md:row-span-2 relative group overflow-hidden cursor-pointer min-h-[400px]"
      >
        <Image
          src={images[0].image.url.startsWith("http")
            ? images[0].image.url
            : `${strapiUrl}${images[0].image.url}`}
          alt={images[0].image.alternativeText}
          width={800}
          height={800}
          class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
        />
        <div
          class="absolute inset-0 bg-primary/0 group-hover:bg-primary/20 transition-colors duration-300"
        >
        </div>
      </div>

      {
        images.slice(1, 4).map((item) => (
          <div class="relative group overflow-hidden cursor-pointer min-h-[200px]">
            <Image
              src={
                item.image.url.startsWith("http")
                  ? item.image.url
                  : `${strapiUrl}${item.image.url}`
              }
              alt={item.image.alternativeText}
              width={400}
              height={400}
              class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
            />
            <div class="absolute inset-0 bg-primary/0 group-hover:bg-primary/20 transition-colors duration-300" />
          </div>
        ))
      }

      <div
        class="relative group overflow-hidden cursor-pointer min-h-[200px] bg-primary flex items-center justify-center"
      >
        <div class="text-center p-6">
          <span class="material-icons-outlined text-white text-4xl mb-2"
            >calendar_today</span
          >
          <h3 class="text-white font-display text-xl mb-2">Umów wizytę</h3>
          <p class="text-white/80 text-xs font-light mb-4">
            Zobacz studio na żywo.
          </p>
          <button
            class="bg-white text-primary px-4 py-2 text-xs uppercase tracking-widest hover:bg-opacity-90"
            >Terminarz</button
          >
        </div>
      </div>
    </div>

    <div class="md:hidden mt-6 text-center">
      <a
        class="text-primary dark:text-white text-sm uppercase tracking-widest border-b border-primary dark:border-white pb-1"
        href="#">Zobacz wszystkie zdjęcia</a
      >
    </div>
  </div>
</section>
