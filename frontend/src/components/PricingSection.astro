---
import { fetchApi } from "../lib/strapi";

interface PricingItem {
  name: string;
  price: string;
  description: string;
  popular?: boolean;
  linkText: string;
}

interface PricingCategory {
  title: string;
  subtitle: string;
  description: string;
  icon: string;
  items: PricingItem[];
}

let categories;
try {
  categories = await fetchApi<PricingCategory[]>({
    endpoint: "pricing-categories",
    query: "populate=items",
  });
} catch (e) {
  categories = null;
}

if (!categories || !Array.isArray(categories) || categories.length === 0) {
  categories = [
    {
      title: "Treningi Indywidualne",
      subtitle: "PEŁNA UWAGA INSTRUKTORA",
      description:
        "Sesja 1:1 podczas której instruktor skupia się wyłącznie na Twoich potrzebach, celach i ewentualnych ograniczeniach ruchowych. Idealnie dla osób, które chcą pracować nad kondycją, jak i dla początkujących oraz osób po kontuzjach.",
      icon: "person",
      items: [
        {
          name: "Trening pojedynczy",
          price: "250 zł",
          description: "Jednorazowy trening personalny (55 min)",
          linkText: "REZERWUJ",
        },
        {
          name: "Pakiet 5 treningów",
          price: "1000 zł",
          description: "Ważny przez 1,5 miesiąca. Cena za sesję: 200 zł",
          popular: true,
          linkText: "WYBIERZ PAKIET",
        },
        {
          name: "Pakiet 10 treningów",
          price: "1900 zł",
          description: "Ważny przez 12 tygodni. Cena za sesję: 190 zł",
          linkText: "WYBIERZ PAKIET",
        },
      ],
    },
    {
      title: "Treningi w Duecie",
      subtitle: "WSPÓLNA MOTYWACJA",
      description:
        "Trening dla par, przyjaciół lub członków rodziny. Znakomita okazja do spędzenia czasu razem w aktywny sposób, przy zachowaniu kameralnego charakteru zajęć.",
      icon: "people",
      items: [
        {
          name: "Trening pojedynczy",
          price: "320 zł",
          description: "Cena za duet (55 min)",
          linkText: "REZERWUJ",
        },
        {
          name: "Pakiet 5 treningów",
          price: "1500 zł",
          description: "Ważny przez 1,5 miesiąca. Cena za trening: 300 zł",
          linkText: "WYBIERZ PAKIET",
        },
        {
          name: "Pakiet 10 treningów",
          price: "2700 zł",
          description: "Ważny przez 12 tygodni. Cena za trening: 270 zł",
          linkText: "WYBIERZ PAKIET",
        },
      ],
    },
  ];
}
---

<section class="py-16 bg-background-light dark:bg-background-dark">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid lg:grid-cols-2 gap-12 lg:gap-16">
      {
        categories.map((category) => (
          <div class="flex flex-col">
            <div class="mb-8 text-center lg:text-left">
              <div class="inline-flex items-center justify-center p-3 bg-primary/10 dark:bg-primary/30 rounded-full mb-4 text-primary dark:text-white">
                <span class="material-icons-outlined text-3xl">
                  {category.icon}
                </span>
              </div>
              <h2 class="text-3xl font-accent text-primary dark:text-white mb-2">
                {category.title}
              </h2>
              <p class="text-gray-500 dark:text-gray-400 font-light text-sm tracking-wide uppercase">
                {category.subtitle}
              </p>
              <p class="mt-4 text-gray-600 dark:text-gray-300 font-light text-sm leading-relaxed">
                {category.description}
              </p>
            </div>
            <div class="bg-surface-light dark:bg-surface-dark shadow-lg dark:shadow-none dark:border dark:border-gray-700 rounded-xl overflow-hidden flex-1 flex flex-col">
              {category.items.map((item, index) => (
                <div
                  class={`p-8 border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors group relative ${index === category.items.length - 1 ? "border-b-0" : ""}`}
                >
                  {item.popular && (
                    <div class="absolute top-0 right-0 bg-primary text-white text-[10px] uppercase font-bold px-3 py-1 rounded-bl-lg">
                      Popularne
                    </div>
                  )}
                  <div class="flex justify-between items-baseline mb-2">
                    <h3 class="text-xl font-medium text-gray-800 dark:text-white">
                      {item.name}
                    </h3>
                    <div class="text-right">
                      <span class="text-2xl font-accent font-semibold text-primary dark:text-white">
                        {item.price}
                      </span>
                    </div>
                  </div>
                  <p class="text-xs text-gray-400 mb-4 font-light leading-relaxed">
                    {item.description}
                  </p>
                  <a
                    href="/kontakt/"
                    class="text-primary dark:text-blue-300 text-xs font-semibold uppercase tracking-widest group-hover:underline decoration-1 underline-offset-4"
                  >
                    {item.linkText}
                  </a>
                </div>
              ))}
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>
